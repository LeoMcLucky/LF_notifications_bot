# Отправляем уведомления о проверке работ DVMN с помощью Telegram bot. 

Программа позволяет автоматически получать уведомления в Telegram о проверке домашних заданий на платформе dvmn.org.
Бот использует механизм long polling API DVMN и присылает сообщения в Telegram, когда преподаватель проверил работу.

### Возможности программы
1. Отслеживает проверки домашних работ на DVMN в реальном времени.
2. Отправляет уведомления в Telegram при появлении новых проверок.
3. Показывает:
    * название урока;
    * результат проверки (с ошибками / принято);
    * ссылку на урок.
4. Корректно обрабатывает:
    * отсутствие интернета;
    * таймауты сервера;
    * неожиданные ошибки.
5. Ведёт логирование работы приложения.

### Как установить

1. Создать Telegram-бота
Для работы программы необходимо создать Telegram-бота и получить токен через [BotFather](https://telegram.me/BotFather)
Также необходимо узнать chat_id, куда бот будет отправлять сообщения.
Чтобы получить свой chat_id, напишите в Telegram специальному боту: [@userinfobot](https://telegram.me/userinfobot)

2. Получить API-токен DVMN
Перейдите в настройки профиля на сайте [dvmn.org](https://dvmn.org/) и получите API-токен.
После регестрации станет доступна ссылка [api_dvmn](https://dvmn.org/api/docs/)

3. Создать файл .env
В корне проекта создайте файл .env и добавьте в него следующие переменные:
```sh
DVMN_TOKEN=your_dvmn_api_token
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

4. Установить зависимости

Рекомендуется использовать [virtualenv/venv](https://docs.python.org/3/library/venv.html) для изоляции проекта. 

Для запуска необходима версия [Python 3.11.*](https://www.python.org/downloads/) и младше 3.10.* так-как модуль imghdr, встроенный в старые версии Python, удалён в Python 3.13. А библиотека python-telegram-bot, всё ещё зависит от него.
Затем используйте `pip` (или `pip3`, есть конфликт с Python2) для установки зависимостей:
```
pip install -r requirements.txt
```

### Как запустить

1. Запускаем терминал - Terminal (macOS/Linux), Windows Terminal (cmd.exe).
2. Перейдите в директорию проекта.
3. Проверяем версию Python `python --version` и какие установлены библиотеки `pip freeze`.
4. В случае успеха. Запускаем программу:
```sh
python main.py
```
После запуска бот начнёт отслеживать проверки работ и отправлять уведомления в Telegram.

### Как работает программа
1. Скрипт отправляет запрос к API DVMN с помощью long polling.
2. Сервер удерживает соединение до появления новых данных.
3. При получении результата проверки:
    * обновляется timestamp;
    * формируется сообщение;
    * отправляется уведомление в Telegram.
4. В случае отсутствия обновлений сервер возвращает новый timestamp.
5. Все события логируются через модуль logging.

### Логирование
Программа использует встроенный модуль logging.
Формат логов:
```
YYYY-MM-DD HH:MM:SS | LEVEL | message
```
Примеры сообщений:
* запуск long polling;
* отсутствие обновлений;
* потеря соединения;
* получение новых проверок;
* неожиданные ошибки.

### Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/).
